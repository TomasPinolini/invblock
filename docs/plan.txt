FINANCIAL COMMAND CENTER — Development Plan
Last Updated: 2026-02-16

================================================================================
1. PROJECT OVERVIEW
================================================================================

  Next.js 16 portfolio tracker for Argentine retail investors.
  Integrations: IOL broker, Binance crypto, Yahoo Finance, Claude AI.
  Stack: TypeScript, Supabase, Drizzle ORM, TanStack Query, Tailwind v4.

  Repo: C:\tom\invblock
  Branches: dev (active development), master (production)

================================================================================
2. COMPLETED — Foundation & Core (Phases 1-4)
================================================================================

  Phase 1: Next.js 16 App Router, Tailwind v4, Drizzle ORM, Zustand, TanStack
  Query. Tables: assets, transactions, user_connections.

  Phase 2: IOL broker integration (auth, sync, trade), Binance crypto, Yahoo
  Finance historical prices. Auto-sync on mount.

  Phase 3: Supabase Auth (all routes protected), login/callback flow, UI polish
  (skeleton, ErrorBoundary, toast, mobile responsive cards).

  Phase 3B: IOL features — account balance, operations history, full trading
  (REAL MONEY), live quotes, historical charts, security search, notifications.

  Phase 4: Edge Functions (daily-report, price-alerts, portfolio-snapshot,
  on-transaction). Tables: price_alerts, portfolio_snapshots. PriceAlertsDialog.

================================================================================
3. COMPLETED — Security & Quality Hardening
================================================================================

  Security: AES-256-GCM credential encryption, rate limiting (13 routes), trade
  hardening (all fields required), audit logging, PDF upload validation, Zod on
  all inputs.

  Testing: Vitest setup, 69 unit tests (utils, crypto, validators, rate-limit).

  Performance: Security headers, dynamic imports, polling tuned, PortfolioTable
  refactored (743→385 lines).

  UX: 55 aria-labels, mobile card layout, trade dialog polish, luxury terminal
  design (Space Grotesk + JetBrains Mono, card depth system, glow effects,
  animations, prefers-reduced-motion).

================================================================================
4. COMPLETED — AI Features (Phase 5)
================================================================================

  Core: Hardened insights endpoint (retry, Zod validation, confidence badges).
  Portfolio health score, trade evaluator, exit advisor, sector/correlation
  analysis, macro context integration (DolarAPI + BCRA), natural language
  portfolio chat (SSE streaming, multi-turn).

  All features on /insights page. 6 AI features total.

================================================================================
5. COMPLETED — MEP Dollar & Mutual Funds
================================================================================

  MEP: Calculator page at /mep (estimate, fee breakdown, rate comparison).
  No execute button yet — needs security audit.

  Funds: Browse-only at /funds (FCICard, FCIFilters, fund types/managers).
  No subscribe/redeem yet.

================================================================================
6. COMPLETED — Edge Functions Expansion (Phase 4B)
================================================================================

  EF1: mep-rate-calculator — fetches USD/ARS rates from dolarapi.com → DB.
  EF2: weekly-digest — AI-powered weekly portfolio email via Brevo.
  EF5: watchlist-price-sync — batch Yahoo Finance quotes → ticker_price_cache.
  EF6: auth-activity-log — security alerts on new device/IP login.

  Also: Sidebar navigation (replaced header), useAuth SSR fix.

  Not implemented: EF3 (rebalance-check), EF4 (dividend-tracker) — skipped.

================================================================================
7. COMPLETED — Email Reports & Analytics
================================================================================

  Emails: Migrated to Brevo, email preferences system (DB + API + UI), opt-out
  checks in all 4 edge functions, rate limiting on sends.

  Analytics: /analytics page with portfolio snapshots and charts.

================================================================================
8. COMPLETED — AI Enhancements
================================================================================

  Smart alert narratives, AI daily digest, exit advisor, correlation analysis,
  macro context, portfolio chat. All deployed (commit aeb1072).

================================================================================
9. COMPLETED — CSV Export
================================================================================

  [x] CSV export on dashboard (portfolio positions) and /history (operations).
      Shared utility: src/lib/csv.ts (BOM for Excel, proper escaping).
      Buttons next to Refresh on both pages.

================================================================================
10. REMAINING ISSUES
================================================================================

  Open Bugs:
    - pg_cron schedules not yet enabled — run 002_automation_tables.sql
    - IOL API only works 11:00-17:00 ART (market hours)

  Technical Debt:
    - Zero E2E tests (Playwright setup deferred)
    - Service client tests need mocking (IOL, Binance, Yahoo)
    - Credentials encryption requires ENCRYPTION_KEY env var (64 hex chars)
    - DNS issues with Fibertel ISP (workaround: pooler connection)
    - No error monitoring in production (see Section 11A)
    - drizzle-kit push broken (check constraint parse error) — use direct SQL
    - Vercel env vars can get deleted — verify before deploys

================================================================================
11. NEXT UP — Operations & Reliability
================================================================================

  A) Error Monitoring
    [ ] Install @sentry/nextjs, configure DSN
    [ ] Wrap trade endpoints with Sentry.captureException
    [ ] Session replay for debugging
    [ ] Alerts: trade failures, auth errors, API 5xx spikes

  B) Deployment & CI
    [ ] GitHub Actions: lint, typecheck, vitest
    [ ] Branch protection on master
    [ ] Pre-deploy checklist, rollback strategy
